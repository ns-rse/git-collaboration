<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Git Collaboration: Hooks</title><meta name="viewport" content="width=device-width, initial-scale=1"><script src="../assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="../assets/styles.css"><script src="../assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" href="../assets/images/UOSSheild_Primary_Violet_RGB.ico" sizes="any"><link rel="icon" href="../assets/images/UOSSheild_Primary_Violet_RGB.svg" type="image/svg+xml"><link rel="manifest" href="../site.webmanifest"><link rel="mask-icon" href="../safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="black"></head><body>
    <header id="top" class="navbar navbar-expand-md top-nav incubator"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <a href="https://www.sheffield.ac.uk" class="external-link">
          <img alt="University of Sheffield" src="../assets/images/UOSLogo_Primary_Violet_RGB.svg" class="light-only"><img alt="University of Sheffield" src="../assets/images/UOSLogo_Primary_White_RGB.svg" class="dark-only"></a>

        <span class="badge text-bg-danger">
          <abbr title="This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.">
            <a href="https://cdh.carpentries.org/the-lesson-life-cycle.html#early-development-pre-alpha-through-alpha" class="external-link alert-link">
              <i aria-hidden="true" class="icon" data-feather="alert-octagon" style="border-radius: 5px"></i>
              Pre-Alpha
            </a>
            <span class="visually-hidden">This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.</span>
          </abbr>
        </span>

      </div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text"><li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul></li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='../hooks.html';">Learner View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav incubator" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="University of Sheffield" src="../assets/images/UOSSheild_Primary_Violet_RGB.svg"></div>
    <div class="lesson-title-md">
      Git Collaboration
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            Git Collaboration
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/instructor-notes.html">Instructor Notes</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/images.html">Extract All Images</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"><hr><li><a class="dropdown-item" href="acknowledgements.html">Acknowledgements</a></li><li><a class="dropdown-item" href="reference.html">Reference</a></li>
          </ul></li>
      </ul></div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="../instructor/aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Git Collaboration
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 50%" class="percentage">
    50%
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: 50%" aria-valuenow="50" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text"><li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul></li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="../hooks.html">Learner View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->

            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Schedule</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="introduction.html">1. Introduction</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="git_hygiene.html">2. Git Hygiene</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="branching.html">3. Branching</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="diverging_branches.html">4. Diverging Branches</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapsecurrent" aria-expanded="true" aria-controls="flush-collapsecurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        5. Hooks
        </span>
      </button>
    </div><!--/div.accordion-header-->

    <div id="flush-collapsecurrent" class="accordion-collapse collapse show" aria-labelledby="flush-headingcurrent" data-bs-parent="#accordionFlushcurrent">
      <div class="accordion-body">
        <ul><li><a href="#what-are-hooks">What are hooks?</a></li>
<li><a href="#pre-commit">Pre-Commit</a></li>
<li><a href="#configuring-pre-commit">Configuring <code>pre-commit</code></a></li>
<li><a href="#installing-pre-commit-hooks">Installing <code>pre-commit</code> hooks</a></li>
<li><a href="#running-pre-commit">Running <code>pre-commit</code></a></li>
<li><a href="#adding-hooks">Adding Hooks</a></li>
<li><a href="#adding-repos">Adding repos</a></li>
<li><a href="#local-repos">Local repos</a></li>
<li><a href="#keeping-pre-commit-tidy">Keeping <code>pre-commit</code> tidy</a></li>
<li><a href="#going-further">Going further</a></li>
<li><a href="#ci"><code>ci:</code></a></li>
        </ul></div><!--/div.accordion-body-->
    </div><!--/div.accordion-collapse-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="continuous_integration.html">6. Continuous Integration</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="additional_topics.html">7. Additional Topics</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush9">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading9">
        <a href="further_resources.html">8. Further Resources</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush lesson-resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="lesson-resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="../instructor/key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="../instructor/instructor-notes.html">Instructor Notes</a>
                      </li>
                      <li>
                        <a href="../instructor/images.html">Extract All Images</a>
                      </li>
                      <hr><li><a class="dropdown-item" href="acknowledgements.html">Acknowledgements</a></li><li><a class="dropdown-item" href="reference.html">Reference</a></li>
                    </ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width lesson-resources"><a href="../instructor/aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">

            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="../instructor/diverging_branches.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="../instructor/continuous_integration.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="../instructor/diverging_branches.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Diverging Branches
        </a>
        <a class="chapter-link float-end" href="../instructor/continuous_integration.html" rel="next">
          Next: Continuous...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>Hooks</h1>
        <p>Last updated on 2024-08-02 |

        <a href="https://github.com/ns-rse/git-collaboration/edit/main/episodes/hooks.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>



        <p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 12 minutes</p>

        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>What the hell are hooks?</li>
<li>How can hooks improve my development workflow?</li>
<li>What is <code>pre-commit</code> and how does it relate to the
<code>pre-commit</code> hook?</li>
<li>What <code>pre-commit</code> hooks are available?</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul><li>Understand what Git hooks are.</li>
<li>Know what the different types of hooks are and where they are
stored.</li>
<li>Understand how <code>pre-commit</code> framework is configured and
runs.</li>
<li>Add new hooks and repos to <code>pre-commit</code>.</li>
<li>How to keep <code>pre-commit</code> tidy.</li>
</ul></div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="what-are-hooks">What are hooks?<a class="anchor" aria-label="anchor" href="#what-are-hooks"></a></h2>
<hr class="half-width"><p>Hooks are actions, typically one or more scripts, that are run in
response to a particular event. Git has a number of stages at which
hooks can be run and events such as <code>commit</code>,
<code>push</code>, <code>pull</code> all have hooks that can run
<code>pre</code> (before) or <code>post</code> (after) the action and
these are <em>really</em> useful for helping automate your workflow as
they can capture problems with linting and tests much earlier in the
development cycle than for example Continuous Integration failing after
pull requests have been made.</p>
<p>In a Git repository hooks live in the <code>.git/hooks</code>
directory and are short <a href="https://www.gnu.org/software/bash/" class="external-link">Bash</a> scripts that are
executed at the relevant stage. We can list the contents of this
directory with <code>ls -lha .git/hooks</code> and you will see there
are a number of executable files with names that indicate at what stage
they are run but all have the <code>.sample</code> extension which means
they are <em>not</em> executed in response to any of the actions.</p>
<div id="accordionInstructor1" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor1" aria-expanded="false" aria-controls="collapseInstructor1">
  <h3 class="accordion-header" id="headingInstructor1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Instructor Note </h3>
</button>
<div id="collapseInstructor1" class="accordion-collapse collapse" data-bs-parent="#accordionInstructor1" aria-labelledby="headingInstructor1">
<div class="accordion-body">
<p>Make sure the audience understands what the <code>commit</code>,
<code>push</code> and <code>pull</code> events are and they they are
actions for git to make on the repository at different stages in the Git
workflow.</p>
</div>
</div>
</div>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>❱ mkdir test
❱ cd test
❱ git init
❱ ls -lha .git/hooks
drwxr-xr-x neil neil 4.0 KB Fri Feb 23 10:40:42 2024 .
drwxr-xr-x neil neil 4.0 KB Fri Feb 23 10:40:46 2024 ..
.rwxr-xr-x neil neil 478 B  Fri Feb 23 10:40:42 2024 applypatch-msg.sample
.rwxr-xr-x neil neil 896 B  Fri Feb 23 10:40:42 2024 commit-msg.sample
.rwxr-xr-x neil neil 4.6 KB Fri Feb 23 10:40:42 2024 fsmonitor-watchman.sample
.rwxr-xr-x neil neil 189 B  Fri Feb 23 10:40:42 2024 post-update.sample
.rwxr-xr-x neil neil 424 B  Fri Feb 23 10:40:42 2024 pre-applypatch.sample
.rwxr-xr-x neil neil 1.6 KB Fri Feb 23 10:40:42 2024 pre-commit.sample
.rwxr-xr-x neil neil 416 B  Fri Feb 23 10:40:42 2024 pre-merge-commit.sample
.rwxr-xr-x neil neil 1.3 KB Fri Feb 23 10:40:42 2024 pre-push.sample
.rwxr-xr-x neil neil 4.8 KB Fri Feb 23 10:40:42 2024 pre-rebase.sample
.rwxr-xr-x neil neil 544 B  Fri Feb 23 10:40:42 2024 pre-receive.sample
.rwxr-xr-x neil neil 1.5 KB Fri Feb 23 10:40:42 2024 prepare-commit-msg.sample
.rwxr-xr-x neil neil 2.7 KB Fri Feb 23 10:40:42 2024 push-to-checkout.sample
.rwxr-xr-x neil neil 2.3 KB Fri Feb 23 10:40:42 2024 sendemail-validate.sample
.rwxr-xr-x neil neil 3.6 KB Fri Feb 23 10:40:42 2024 update.sample
</code></pre>
</div>
<p>If you create a repository on <a href="https://github.com" class="external-link">GitHub</a>, <a href="https://gitlab.com" class="external-link">GitLab</a> or another forge when you clone it
locally these samples are created on your system. They are <em>not</em>
part of the repository itself as files under the <code>.git</code>
directory are not part of the repository.</p>
<div id="challenge-1-checking-out-and-enable-sample-hooks" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-1-checking-out-and-enable-sample-hooks" class="callout-inner">
<h3 class="callout-title">Challenge 1: Checking out and enable sample hooks</h3>
<div class="callout-content">
<p>Lets take a look at the hooks in the <a href="https://github.com/ns-rse/python-maths" class="external-link"><code>python-maths</code></a>
repository you have cloned for this course.</p>
<ol style="list-style-type: decimal"><li>What does <code>.git/hooks/pre-push.sample</code> do?</li>
<li>Enable the <code>.git/hooks/pre-push</code> using the
<code>.git/hooks/pre-push.sample</code>.</li>
<li>Test the enabled hook by making an empty commit that will trigger
the hook (<strong>hint</strong> it is case-sensitive).</li>
</ol></div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Solution 1: What does .git/hooks/pre-push.sample do? </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>Git will have populated the <code>.git/hooks</code> directory
automatically when you cloned the <a href="https://github.com/ns-rse/python-maths" class="external-link"><code>python-maths</code></a>.</p>
<ol style="list-style-type: decimal"><li>Change directory to the cloned <code>python-maths</code>
directory.</li>
<li>Look at the file <code>.git/hooks/pre-push.sample</code>.</li>
</ol><div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="ex">❱</span> cd python-maths</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="ex">❱</span> cat .git/hooks/pre-push.sample</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="co">#!/bin/sh</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="co"># An example hook script to verify what is about to be pushed.  Called by "git</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="co"># push" after it has checked the remote status, but before anything has been</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a><span class="co"># pushed.  If this script exits with a non-zero status nothing will be pushed.</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a><span class="co"># This hook is called with the following parameters:</span></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a><span class="co"># $1 -- Name of the remote to which the push is being done</span></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a><span class="co"># $2 -- URL to which the push is being done</span></span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a><span class="co"># If pushing without using a named remote those arguments will be equal.</span></span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a><span class="co"># Information about the commits which are being pushed is supplied as lines to</span></span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a><span class="co"># the standard input in the form:</span></span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a><span class="co">#   &lt;local ref&gt; &lt;local oid&gt; &lt;remote ref&gt; &lt;remote oid&gt;</span></span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb2-21"><a href="#cb2-21" tabindex="-1"></a><span class="co"># This sample shows how to prevent push of commits where the log message starts</span></span>
<span id="cb2-22"><a href="#cb2-22" tabindex="-1"></a><span class="co"># with "WIP" (work in progress).</span></span>
<span id="cb2-23"><a href="#cb2-23" tabindex="-1"></a></span>
<span id="cb2-24"><a href="#cb2-24" tabindex="-1"></a><span class="va">remote</span><span class="op">=</span><span class="st">"</span><span class="va">$1</span><span class="st">"</span></span>
<span id="cb2-25"><a href="#cb2-25" tabindex="-1"></a><span class="va">url</span><span class="op">=</span><span class="st">"</span><span class="va">$2</span><span class="st">"</span></span>
<span id="cb2-26"><a href="#cb2-26" tabindex="-1"></a></span>
<span id="cb2-27"><a href="#cb2-27" tabindex="-1"></a><span class="va">zero</span><span class="op">=</span><span class="va">$(</span><span class="fu">git</span> hash-object <span class="at">--stdin</span> <span class="op">&lt;</span>/dev/null <span class="kw">|</span> <span class="fu">tr</span> <span class="st">'[0-9a-f]'</span> <span class="st">'0'</span><span class="va">)</span></span>
<span id="cb2-28"><a href="#cb2-28" tabindex="-1"></a></span>
<span id="cb2-29"><a href="#cb2-29" tabindex="-1"></a><span class="cf">while</span> <span class="bu">read</span> <span class="va">local_ref</span> <span class="va">local_oid</span> <span class="va">remote_ref</span> <span class="va">remote_oid</span></span>
<span id="cb2-30"><a href="#cb2-30" tabindex="-1"></a><span class="cf">do</span></span>
<span id="cb2-31"><a href="#cb2-31" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">test</span> <span class="st">"</span><span class="va">$local_oid</span><span class="st">"</span> = <span class="st">"</span><span class="va">$zero</span><span class="st">"</span></span>
<span id="cb2-32"><a href="#cb2-32" tabindex="-1"></a>    <span class="cf">then</span></span>
<span id="cb2-33"><a href="#cb2-33" tabindex="-1"></a>        <span class="co"># Handle delete</span></span>
<span id="cb2-34"><a href="#cb2-34" tabindex="-1"></a>        <span class="bu">:</span></span>
<span id="cb2-35"><a href="#cb2-35" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb2-36"><a href="#cb2-36" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">test</span> <span class="st">"</span><span class="va">$remote_oid</span><span class="st">"</span> = <span class="st">"</span><span class="va">$zero</span><span class="st">"</span></span>
<span id="cb2-37"><a href="#cb2-37" tabindex="-1"></a>        <span class="cf">then</span></span>
<span id="cb2-38"><a href="#cb2-38" tabindex="-1"></a>            <span class="co"># New branch, examine all commits</span></span>
<span id="cb2-39"><a href="#cb2-39" tabindex="-1"></a>            <span class="va">range</span><span class="op">=</span><span class="st">"</span><span class="va">$local_oid</span><span class="st">"</span></span>
<span id="cb2-40"><a href="#cb2-40" tabindex="-1"></a>        <span class="cf">else</span></span>
<span id="cb2-41"><a href="#cb2-41" tabindex="-1"></a>            <span class="co"># Update to existing branch, examine new commits</span></span>
<span id="cb2-42"><a href="#cb2-42" tabindex="-1"></a>            <span class="va">range</span><span class="op">=</span><span class="st">"</span><span class="va">$remote_oid</span><span class="st">..</span><span class="va">$local_oid</span><span class="st">"</span></span>
<span id="cb2-43"><a href="#cb2-43" tabindex="-1"></a>        <span class="cf">fi</span></span>
<span id="cb2-44"><a href="#cb2-44" tabindex="-1"></a></span>
<span id="cb2-45"><a href="#cb2-45" tabindex="-1"></a>        <span class="co"># Check for WIP commit</span></span>
<span id="cb2-46"><a href="#cb2-46" tabindex="-1"></a>        <span class="va">commit</span><span class="op">=</span><span class="va">$(</span><span class="fu">git</span> rev-list <span class="at">-n</span> 1 <span class="at">--grep</span> <span class="st">'^WIP'</span> <span class="st">"</span><span class="va">$range</span><span class="st">"</span><span class="va">)</span></span>
<span id="cb2-47"><a href="#cb2-47" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">test</span> <span class="at">-n</span> <span class="st">"</span><span class="va">$commit</span><span class="st">"</span></span>
<span id="cb2-48"><a href="#cb2-48" tabindex="-1"></a>        <span class="cf">then</span></span>
<span id="cb2-49"><a href="#cb2-49" tabindex="-1"></a>            <span class="bu">echo</span> <span class="op">&gt;&amp;</span><span class="dv">2</span> <span class="st">"Found WIP commit in </span><span class="va">$local_ref</span><span class="st">, not pushing"</span></span>
<span id="cb2-50"><a href="#cb2-50" tabindex="-1"></a>            <span class="bu">exit</span> 1</span>
<span id="cb2-51"><a href="#cb2-51" tabindex="-1"></a>        <span class="cf">fi</span></span>
<span id="cb2-52"><a href="#cb2-52" tabindex="-1"></a>    <span class="cf">fi</span></span>
<span id="cb2-53"><a href="#cb2-53" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb2-54"><a href="#cb2-54" tabindex="-1"></a></span>
<span id="cb2-55"><a href="#cb2-55" tabindex="-1"></a><span class="bu">exit</span> 0</span></code></pre>
</div>
<p>When enabled this hook will “<em>prevent push of commits where the
log message starts with ”WIP” (work in progress)</em>”</p>
</div>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Solution 2: Enable the pre-push hook and test it </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<p>This sounds like a good idea as it, notionally, prevents people from
pushing work that is in progress, if they are in the habit of starting
commit messages with “WIP”.</p>
<ol style="list-style-type: decimal"><li>Enable the hook.</li>
<li>Create a new branch <code>&lt;github-user&gt;/test-hook</code> to
test the hook on.</li>
<li>Make an empty commit with a message that starts with
<code>WIP</code>
e.g. <code>git commit --allow-empty "WIP - testing the    pre-push commit"</code>.
Was the commit pushed?</li>
<li>Delete the branch you created.</li>
</ol><div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="ex">❱</span> cd python-maths</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="ex">❱</span> cp .git/hooks/pre-push.sample .git/hooks/pre-push</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Solution 3: Test the hook </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<p>We can test the hook by making a throw-away branch and adding an
empty commit that starts with <code>WIP</code> and then trying to
<code>git push</code> the commit. After it fails we can force delete
this test branch.</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="ex">❱</span> git switch <span class="at">-c</span> ns-rse/test-hook</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="ex">❱</span> git commit <span class="at">--allow-empty</span> <span class="at">-m</span> <span class="st">"WIP - testing the pre-push hook"</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="ex">❱</span> git push</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="ex">Found</span> WIP commit in refs/heads/ns-rse/test-hook, not pushing</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="ex">error:</span> failed to push some refs to <span class="st">'github.com:slackline/python-maths.git'</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="ex">❱</span> git switch main</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="ex">❱</span> git branch <span class="at">-D</span> ns-rse/test-hook</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="callout1" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout</h3>
<div class="callout-content">
<p>You may have encountered the <a href="https://docs.github.com/en/get-started/using-git/dealing-with-non-fast-forward-errors" class="external-link">non-fast-forward
error</a> when attempting to push your changes to a remote. As the
message shows this is because there are changes to the remote branch
that are not in the local branch and you are advised to
<code>git pull</code> before attempting to <code>git push</code>
again.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="ex">❱</span> git push origin main</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="op">&gt;</span> To <span class="ex">https://github.com/USERNAME/REPOSITORY.git</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="op">&gt;</span>  ! <span class="ex">[rejected]</span>        main <span class="at">-</span><span class="op">&gt;</span> main <span class="er">(</span><span class="ex">non-fast-forward</span><span class="kw">)</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="op">&gt;</span> error: <span class="ex">failed</span> to push some refs to <span class="st">'https://github.com/USERNAME/REPOSITORY.git'</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="op">&gt;</span> To <span class="ex">prevent</span> you from losing history, non-fast-forward updates were rejected</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a><span class="op">&gt;</span> Merge <span class="ex">the</span> remote changes <span class="er">(</span><span class="ex">e.g.</span> <span class="st">'git pull'</span><span class="kw">)</span> <span class="ex">before</span> pushing again.  See the</span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a><span class="op">&gt;</span> <span class="st">'Note about fast-forwards'</span> <span class="ex">section</span> of <span class="st">'git push --help'</span> for details.</span></code></pre>
</div>
<p>A simple addition you can add to the <code>.git/hooks/pre-push</code>
script is to have it <code>git fetch</code> before attempting to make a
<code>git push</code> which retrieve details, but not pull them, of
changes that have been made to the branch on <code>origin</code>.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="co">#!/bin/sh</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="co"># A hook script to pull before pushing</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="bu">exec</span> git fetch</span></code></pre>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="pre-commit">Pre-Commit<a class="anchor" aria-label="anchor" href="#pre-commit"></a></h2>
<hr class="half-width"><p>Pre-commit hooks that run before commits are made are <em>really</em>
useful to the extent that they require special discussion and will be
the focus of the remainder of this episode. Why are they so useful? It’s
because they shorten the feedback loop of changes that need to be made
when checking and linting code. It may seem mundane and unnecessary to
apply such standards to your code, particularly if it is just
exploratory code development, but over time if you employ these tools
the way in which you write code will change so that it becomes natural
to write code that is formatted and linted and should you then decide
that code is ready to be used beyond exploratory stage it will not need
refactoring in order to get it in shape. In essence this encourages
adoption of good coding practices from the outset, taking
responsibility/ownership of the code you write so that it is to the
highest standards it can be. In the long run t is better to form good
habits than bad ones and hooks help you do so.</p>
<p>There is a framework for <code>pre-commit</code> hooks called,
unsurprisingly, <a href="https://pre-commit.com" class="external-link">pre-commit</a> that
makes it incredibly easy to add (and configure) some really useful
<code>pre-commit</code> hooks to your workflow.</p>
<div id="callout2" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout</h3>
<div class="callout-content">
<p>From here on whenever <code>pre-commit</code> is mentioned it refers
to the Python package <a href="https://pre-commit.com" class="external-link">pre-commit</a>
and <em>not</em> the hook that resides at
<code>.git/hooks/pre-commit</code>, although we will look at that
file.</p>
</div>
</div>
</div>
<div class="section level3">
<h3 id="why-are-pre-commit-hooks-so-important">Why are Pre-Commit hooks so important?<a class="anchor" aria-label="anchor" href="#why-are-pre-commit-hooks-so-important"></a></h3>
<p>You may be wondering why running hooks prior to commits is so
important. The short answer is that it reduces the feedback loop and
speeds up the pace of development. The long answer is that it only
really becomes apparent after using them so we’re going to have a go at
installing and enabling some <code>pre-commit</code> hooks on our code
base, making some changes and committing them.</p>
</div>
<div class="section level3">
<h3 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a></h3>
<p><a href="https://pre-commit.com" class="external-link">pre-commit</a> is written in <a href="https://python.org" class="external-link">Python</a> but hooks are available that lint,
check and test many languages other than Python. Many Linux systems have
<a href="https://pre-commit.com" class="external-link">pre-commit</a> in their package
management systems so if you are using Linux or OSX you can install
these at the system level.</p>
<p>However, for this course the setup instructions asked you to install
<a href="https://docs.anaconda.com/free/miniconda/" class="external-link">Miniconda</a> and we
can install <a href="https://pre-commit.com" class="external-link"><code>pre-commit</code></a>
in a Conda environment to leverage it. The steps to do so are</p>
<ol style="list-style-type: decimal"><li>Create a Conda environment called <code>python-maths</code> with
<code>conda create -n python-maths python=3.11</code>
</li>
<li>Activate the newly created <code>python-maths</code>
environment.</li>
<li>Install <code>pre-commit</code> in the <code>python-maths</code>
repository.</li>
</ol><div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="ex">❱</span> conda create <span class="at">-n</span> python-maths python=3.11 pre-commit</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="ex">Retrieving</span> notices: ...working... done</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="ex">Collecting</span> package metadata <span class="er">(</span><span class="ex">current_repodata.json</span><span class="kw">)</span><span class="bu">:</span> done</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="ex">Solving</span> environment: done</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a><span class="ex">==</span><span class="op">&gt;</span> WARNING: A newer version of conda exists. <span class="op">&lt;</span>==</span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>  <span class="ex">current</span> version: 24.4.0</span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>  <span class="ex">latest</span> version: 24.5.0</span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a><span class="ex">Please</span> update conda by running</span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a></span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a>    <span class="ex">$</span> conda update <span class="at">-n</span> base <span class="at">-c</span> defaults conda</span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a><span class="ex">Or</span> to minimize the number of packages updated during conda update use</span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a></span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a>     <span class="ex">conda</span> install conda=24.5.0</span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a></span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a></span>
<span id="cb7-20"><a href="#cb7-20" tabindex="-1"></a></span>
<span id="cb7-21"><a href="#cb7-21" tabindex="-1"></a><span class="co">## Package Plan ##</span></span>
<span id="cb7-22"><a href="#cb7-22" tabindex="-1"></a></span>
<span id="cb7-23"><a href="#cb7-23" tabindex="-1"></a>  <span class="ex">environment</span> location: /home/neil/miniconda3/envs/python-maths</span>
<span id="cb7-24"><a href="#cb7-24" tabindex="-1"></a></span>
<span id="cb7-25"><a href="#cb7-25" tabindex="-1"></a>  <span class="ex">added</span> / updated specs:</span>
<span id="cb7-26"><a href="#cb7-26" tabindex="-1"></a>    <span class="ex">-</span> pre-commit</span>
<span id="cb7-27"><a href="#cb7-27" tabindex="-1"></a>    <span class="ex">-</span> python=3.11</span>
<span id="cb7-28"><a href="#cb7-28" tabindex="-1"></a></span>
<span id="cb7-29"><a href="#cb7-29" tabindex="-1"></a></span>
<span id="cb7-30"><a href="#cb7-30" tabindex="-1"></a><span class="ex">The</span> following packages will be downloaded:</span>
<span id="cb7-31"><a href="#cb7-31" tabindex="-1"></a></span>
<span id="cb7-32"><a href="#cb7-32" tabindex="-1"></a>    <span class="ex">package</span>                    <span class="kw">|</span>            <span class="ex">build</span></span>
<span id="cb7-33"><a href="#cb7-33" tabindex="-1"></a>    <span class="ex">---------------------------</span><span class="kw">|</span><span class="ex">-----------------</span></span>
<span id="cb7-34"><a href="#cb7-34" tabindex="-1"></a>    <span class="ex">cffi-1.16.0</span>                <span class="kw">|</span>  <span class="ex">py311h5eee18b_1</span>         313 KB</span>
<span id="cb7-35"><a href="#cb7-35" tabindex="-1"></a>    <span class="ex">distlib-0.3.8</span>              <span class="kw">|</span>  <span class="ex">py311h06a4308_0</span>         456 KB</span>
<span id="cb7-36"><a href="#cb7-36" tabindex="-1"></a>    <span class="ex">openssl-3.0.13</span>             <span class="kw">|</span>       <span class="ex">h7f8727e_2</span>         5.2 MB</span>
<span id="cb7-37"><a href="#cb7-37" tabindex="-1"></a>    <span class="ex">platformdirs-3.10.0</span>        <span class="kw">|</span>  <span class="ex">py311h06a4308_0</span>          37 KB</span>
<span id="cb7-38"><a href="#cb7-38" tabindex="-1"></a>    <span class="ex">virtualenv-20.26.1</span>         <span class="kw">|</span>  <span class="ex">py311h06a4308_0</span>         3.5 MB</span>
<span id="cb7-39"><a href="#cb7-39" tabindex="-1"></a>    <span class="ex">------------------------------------------------------------</span></span>
<span id="cb7-40"><a href="#cb7-40" tabindex="-1"></a>                                           <span class="ex">Total:</span>         9.5 MB</span>
<span id="cb7-41"><a href="#cb7-41" tabindex="-1"></a></span>
<span id="cb7-42"><a href="#cb7-42" tabindex="-1"></a><span class="ex">The</span> following NEW packages will be INSTALLED:</span>
<span id="cb7-43"><a href="#cb7-43" tabindex="-1"></a></span>
<span id="cb7-44"><a href="#cb7-44" tabindex="-1"></a>  <span class="ex">_libgcc_mutex</span>      pkgs/main/linux-64::_libgcc_mutex-0.1-main</span>
<span id="cb7-45"><a href="#cb7-45" tabindex="-1"></a>  <span class="ex">_openmp_mutex</span>      pkgs/main/linux-64::_openmp_mutex-5.1-1_gnu</span>
<span id="cb7-46"><a href="#cb7-46" tabindex="-1"></a>  <span class="fu">bzip2</span>              pkgs/main/linux-64::bzip2-1.0.8-h5eee18b_6</span>
<span id="cb7-47"><a href="#cb7-47" tabindex="-1"></a>  <span class="ex">ca-certificates</span>    pkgs/main/linux-64::ca-certificates-2024.3.11-h06a4308_0</span>
<span id="cb7-48"><a href="#cb7-48" tabindex="-1"></a>  <span class="ex">cffi</span>               pkgs/main/linux-64::cffi-1.16.0-py311h5eee18b_1</span>
<span id="cb7-49"><a href="#cb7-49" tabindex="-1"></a>  <span class="ex">cfgv</span>               pkgs/main/linux-64::cfgv-3.4.0-py311h06a4308_0</span>
<span id="cb7-50"><a href="#cb7-50" tabindex="-1"></a>  <span class="ex">distlib</span>            pkgs/main/linux-64::distlib-0.3.8-py311h06a4308_0</span>
<span id="cb7-51"><a href="#cb7-51" tabindex="-1"></a>  <span class="ex">filelock</span>           pkgs/main/linux-64::filelock-3.13.1-py311h06a4308_0</span>
<span id="cb7-52"><a href="#cb7-52" tabindex="-1"></a>  <span class="ex">identify</span>           pkgs/main/linux-64::identify-2.5.5-py311h06a4308_0</span>
<span id="cb7-53"><a href="#cb7-53" tabindex="-1"></a>  <span class="ex">ld_impl_linux-64</span>   pkgs/main/linux-64::ld_impl_linux-64-2.38-h1181459_1</span>
<span id="cb7-54"><a href="#cb7-54" tabindex="-1"></a>  <span class="ex">libffi</span>             pkgs/main/linux-64::libffi-3.4.4-h6a678d5_1</span>
<span id="cb7-55"><a href="#cb7-55" tabindex="-1"></a>  <span class="ex">libgcc-ng</span>          pkgs/main/linux-64::libgcc-ng-11.2.0-h1234567_1</span>
<span id="cb7-56"><a href="#cb7-56" tabindex="-1"></a>  <span class="ex">libgomp</span>            pkgs/main/linux-64::libgomp-11.2.0-h1234567_1</span>
<span id="cb7-57"><a href="#cb7-57" tabindex="-1"></a>  <span class="ex">libstdcxx-ng</span>       pkgs/main/linux-64::libstdcxx-ng-11.2.0-h1234567_1</span>
<span id="cb7-58"><a href="#cb7-58" tabindex="-1"></a>  <span class="ex">libuuid</span>            pkgs/main/linux-64::libuuid-1.41.5-h5eee18b_0</span>
<span id="cb7-59"><a href="#cb7-59" tabindex="-1"></a>  <span class="ex">ncurses</span>            pkgs/main/linux-64::ncurses-6.4-h6a678d5_0</span>
<span id="cb7-60"><a href="#cb7-60" tabindex="-1"></a>  <span class="ex">nodeenv</span>            pkgs/main/linux-64::nodeenv-1.7.0-py311h06a4308_0</span>
<span id="cb7-61"><a href="#cb7-61" tabindex="-1"></a>  <span class="ex">openssl</span>            pkgs/main/linux-64::openssl-3.0.13-h7f8727e_2</span>
<span id="cb7-62"><a href="#cb7-62" tabindex="-1"></a>  <span class="ex">pip</span>                pkgs/main/linux-64::pip-24.0-py311h06a4308_0</span>
<span id="cb7-63"><a href="#cb7-63" tabindex="-1"></a>  <span class="ex">platformdirs</span>       pkgs/main/linux-64::platformdirs-3.10.0-py311h06a4308_0</span>
<span id="cb7-64"><a href="#cb7-64" tabindex="-1"></a>  <span class="ex">pre-commit</span>         pkgs/main/linux-64::pre-commit-3.4.0-py311h06a4308_1</span>
<span id="cb7-65"><a href="#cb7-65" tabindex="-1"></a>  <span class="ex">pycparser</span>          pkgs/main/noarch::pycparser-2.21-pyhd3eb1b0_0</span>
<span id="cb7-66"><a href="#cb7-66" tabindex="-1"></a>  <span class="ex">python</span>             pkgs/main/linux-64::python-3.11.9-h955ad1f_0</span>
<span id="cb7-67"><a href="#cb7-67" tabindex="-1"></a>  <span class="ex">pyyaml</span>             pkgs/main/linux-64::pyyaml-6.0.1-py311h5eee18b_0</span>
<span id="cb7-68"><a href="#cb7-68" tabindex="-1"></a>  <span class="ex">readline</span>           pkgs/main/linux-64::readline-8.2-h5eee18b_0</span>
<span id="cb7-69"><a href="#cb7-69" tabindex="-1"></a>  <span class="ex">setuptools</span>         pkgs/main/linux-64::setuptools-69.5.1-py311h06a4308_0</span>
<span id="cb7-70"><a href="#cb7-70" tabindex="-1"></a>  <span class="ex">sqlite</span>             pkgs/main/linux-64::sqlite-3.45.3-h5eee18b_0</span>
<span id="cb7-71"><a href="#cb7-71" tabindex="-1"></a>  <span class="ex">tk</span>                 pkgs/main/linux-64::tk-8.6.14-h39e8969_0</span>
<span id="cb7-72"><a href="#cb7-72" tabindex="-1"></a>  <span class="ex">tzdata</span>             pkgs/main/noarch::tzdata-2024a-h04d1e81_0</span>
<span id="cb7-73"><a href="#cb7-73" tabindex="-1"></a>  <span class="ex">ukkonen</span>            pkgs/main/linux-64::ukkonen-1.0.1-py311hdb19cb5_0</span>
<span id="cb7-74"><a href="#cb7-74" tabindex="-1"></a>  <span class="ex">virtualenv</span>         pkgs/main/linux-64::virtualenv-20.26.1-py311h06a4308_0</span>
<span id="cb7-75"><a href="#cb7-75" tabindex="-1"></a>  <span class="ex">wheel</span>              pkgs/main/linux-64::wheel-0.43.0-py311h06a4308_0</span>
<span id="cb7-76"><a href="#cb7-76" tabindex="-1"></a>  <span class="fu">xz</span>                 pkgs/main/linux-64::xz-5.4.6-h5eee18b_1</span>
<span id="cb7-77"><a href="#cb7-77" tabindex="-1"></a>  <span class="ex">yaml</span>               pkgs/main/linux-64::yaml-0.2.5-h7b6447c_0</span>
<span id="cb7-78"><a href="#cb7-78" tabindex="-1"></a>  <span class="ex">zlib</span>               pkgs/main/linux-64::zlib-1.2.13-h5eee18b_1</span>
<span id="cb7-79"><a href="#cb7-79" tabindex="-1"></a></span>
<span id="cb7-80"><a href="#cb7-80" tabindex="-1"></a></span>
<span id="cb7-81"><a href="#cb7-81" tabindex="-1"></a><span class="ex">Proceed</span> <span class="er">(</span><span class="ex">[y]/n</span><span class="kw">)</span><span class="ex">?</span></span>
<span id="cb7-82"><a href="#cb7-82" tabindex="-1"></a></span>
<span id="cb7-83"><a href="#cb7-83" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb7-84"><a href="#cb7-84" tabindex="-1"></a></span>
<span id="cb7-85"><a href="#cb7-85" tabindex="-1"></a><span class="ex">❱</span> conda activate python-maths</span>
<span id="cb7-86"><a href="#cb7-86" tabindex="-1"></a><span class="kw">(</span><span class="ex">python-maths</span><span class="kw">)</span> <span class="ex">❱</span> pre-commit install</span>
<span id="cb7-87"><a href="#cb7-87" tabindex="-1"></a><span class="ex">pre-commit</span> installed at .git/hooks/pre-commit</span></code></pre>
</div>
<div id="callout3" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout</h3>
<div class="callout-content">
<p>Examples of installing <a href="https://pre-commit.com" class="external-link">pre-commit</a> at the system level for
different Linux systems or OSX. Note you will need to have
<code>root</code> access to install packages on your Linux system.</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="co"># Arch Linux</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="ex">❱</span> pacman <span class="at">-Syu</span> pre-commit</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="co"># Gentoo</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="ex">❱</span> emerge <span class="at">-av</span> pre-commit</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="co"># Debin/Ubuntu</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a><span class="ex">❱</span> apt-get install pre-commit</span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="co"># OSX Homebrew</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="ex">❱</span> brew install pre-commit</span></code></pre>
</div>
<p>The advantage of this is that you will be able to
<code>pre-commit install</code> in any repository without first having
to activate a virtual environment.</p>
</div>
</div>
</div>
<div id="challenge-2---checking-out-the-installed-pre-commit-hook" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-2---checking-out-the-installed-pre-commit-hook" class="callout-inner">
<h3 class="callout-title">Challenge 2 - Checking out the installed
<code>pre-commit</code> hook</h3>
<div class="callout-content">
<p>We have just installed <code>pre-commit</code> locally in the
<code>python-maths</code> repository lets see what it has done.</p>
<ul><li>What will the message say if <code>pre-commit</code> can not be
found by the <code>pre-commit</code> hook? (<strong>Hint</strong> - look
for the line that starts with <code>echo</code>)</li>
</ul></div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4"> Show me the solution </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" data-bs-parent="#accordionSolution4" aria-labelledby="headingSolution4">
<div class="accordion-body">
<p>We can look at the <code>.git/hooks/pre-commit</code> file that we
were told was installed.</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="ex">❱</span> cat .git/hooks/pre-commit</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="co">#!/usr/bin/env bash</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="co"># File generated by pre-commit: https://pre-commit.com</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="co"># ID: 138fd403232d2ddd5efb44317e38bf03</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a><span class="co"># start templated</span></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a><span class="va">INSTALL_PYTHON</span><span class="op">=</span>/home/neil/miniconda3/envs/python-maths/bin/python</span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a><span class="va">ARGS</span><span class="op">=</span><span class="va">(</span>hook-impl --config=.pre-commit-config.yaml --hook-type=pre-commit<span class="va">)</span></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a><span class="co"># end templated</span></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a><span class="va">HERE</span><span class="op">=</span><span class="st">"</span><span class="va">$(</span><span class="bu">cd</span> <span class="st">"</span><span class="va">$(</span><span class="fu">dirname</span> <span class="st">"</span><span class="va">$0</span><span class="st">"</span><span class="va">)</span><span class="st">"</span> <span class="kw">&amp;&amp;</span> <span class="bu">pwd</span><span class="va">)</span><span class="st">"</span></span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a><span class="va">ARGS</span><span class="op">+=</span><span class="va">(</span>--hook-dir <span class="st">"</span><span class="va">$HERE</span><span class="st">"</span> -- <span class="st">"</span><span class="va">$@</span><span class="st">"</span><span class="va">)</span></span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a><span class="cf">if</span> <span class="bu">[</span> <span class="ot">-x</span> <span class="st">"</span><span class="va">$INSTALL_PYTHON</span><span class="st">"</span> <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a>    <span class="bu">exec</span> <span class="st">"</span><span class="va">$INSTALL_PYTHON</span><span class="st">"</span> <span class="at">-mpre_commit</span> <span class="st">"</span><span class="va">${ARGS</span><span class="op">[@]</span><span class="va">}</span><span class="st">"</span></span>
<span id="cb9-16"><a href="#cb9-16" tabindex="-1"></a><span class="cf">elif</span> <span class="bu">command</span> <span class="at">-v</span> pre-commit <span class="op">&gt;</span> /dev/null<span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb9-17"><a href="#cb9-17" tabindex="-1"></a>    <span class="bu">exec</span> pre-commit <span class="st">"</span><span class="va">${ARGS</span><span class="op">[@]</span><span class="va">}</span><span class="st">"</span></span>
<span id="cb9-18"><a href="#cb9-18" tabindex="-1"></a><span class="cf">else</span></span>
<span id="cb9-19"><a href="#cb9-19" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">'`pre-commit` not found.  Did you forget to activate your virtualenv?'</span> <span class="dv">1</span><span class="op">&gt;&amp;</span><span class="dv">2</span></span>
<span id="cb9-20"><a href="#cb9-20" tabindex="-1"></a>    <span class="bu">exit</span> 1</span>
<span id="cb9-21"><a href="#cb9-21" tabindex="-1"></a><span class="cf">fi</span></span></code></pre>
</div>
<p>We see that near the end a message is <code>echo</code> that prints
what follows to the terminal so if we get to that point the sentence
“<em><code>pre-commit</code> not found. Did you forget to activate your
virtualenv?</em>” will be printed.</p>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="configuring-pre-commit">Configuring <code>pre-commit</code>
<a class="anchor" aria-label="anchor" href="#configuring-pre-commit"></a></h2>
<hr class="half-width"><p><code>pre-commit</code> needs configuring and this is done via the
<code>.pre-commit-config.yaml</code> file that lives at the root
(top-level) of your repository. The <code>python-maths</code> repository
already includes such a file so you will have a copy in your local
clone.</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="ex">repos:</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>  <span class="ex">-</span> repo: https://github.com/pre-commit/pre-commit-hooks</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>    <span class="ex">rev:</span> v4.5.0 <span class="co"># Use the ref you want to point at</span></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>    <span class="ex">hooks:</span></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>      <span class="ex">-</span> id: check-case-conflict</span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>      <span class="ex">-</span> id: check-docstring-first</span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>      <span class="ex">-</span> id: check-merge-conflict</span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a>      <span class="ex">-</span> id: check-toml</span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a>      <span class="ex">-</span> id: check-yaml</span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a>      <span class="ex">-</span> id: debug-statements</span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a>      <span class="ex">-</span> id: end-of-file-fixer</span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a>        <span class="ex">types:</span> <span class="pp">[</span><span class="ss">python</span><span class="pp">]</span></span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a>      <span class="ex">-</span> id: fix-byte-order-marker</span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a>      <span class="ex">-</span> id: name-tests-test</span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a>        <span class="ex">args:</span> <span class="pp">[</span><span class="st">"--pytest-test-first"</span><span class="pp">]</span></span>
<span id="cb10-16"><a href="#cb10-16" tabindex="-1"></a>      <span class="ex">-</span> id: no-commit-to-branch <span class="co"># Protects main/master by default</span></span>
<span id="cb10-17"><a href="#cb10-17" tabindex="-1"></a>      <span class="ex">-</span> id: requirements-txt-fixer</span>
<span id="cb10-18"><a href="#cb10-18" tabindex="-1"></a>      <span class="ex">-</span> id: trailing-whitespace</span>
<span id="cb10-19"><a href="#cb10-19" tabindex="-1"></a>        <span class="ex">types:</span> [python, yaml, markdown]</span>
<span id="cb10-20"><a href="#cb10-20" tabindex="-1"></a></span>
<span id="cb10-21"><a href="#cb10-21" tabindex="-1"></a>  <span class="ex">-</span> repo: https://github.com/DavidAnson/markdownlint-cli2</span>
<span id="cb10-22"><a href="#cb10-22" tabindex="-1"></a>    <span class="ex">rev:</span> v0.11.0</span>
<span id="cb10-23"><a href="#cb10-23" tabindex="-1"></a>    <span class="ex">hooks:</span></span>
<span id="cb10-24"><a href="#cb10-24" tabindex="-1"></a>      <span class="ex">-</span> id: markdownlint-cli2</span>
<span id="cb10-25"><a href="#cb10-25" tabindex="-1"></a>        <span class="ex">args:</span> []</span>
<span id="cb10-26"><a href="#cb10-26" tabindex="-1"></a></span>
<span id="cb10-27"><a href="#cb10-27" tabindex="-1"></a>  <span class="ex">-</span> repo: https://github.com/asottile/pyupgrade</span>
<span id="cb10-28"><a href="#cb10-28" tabindex="-1"></a>    <span class="ex">rev:</span> v3.15.0</span>
<span id="cb10-29"><a href="#cb10-29" tabindex="-1"></a>    <span class="ex">hooks:</span></span>
<span id="cb10-30"><a href="#cb10-30" tabindex="-1"></a>      <span class="ex">-</span> id: pyupgrade</span>
<span id="cb10-31"><a href="#cb10-31" tabindex="-1"></a>        <span class="ex">args:</span> <span class="pp">[--</span><span class="ss">py38</span><span class="pp">-</span><span class="ss">plus</span><span class="pp">]</span></span>
<span id="cb10-32"><a href="#cb10-32" tabindex="-1"></a></span>
<span id="cb10-33"><a href="#cb10-33" tabindex="-1"></a>  <span class="ex">-</span> repo: https://github.com/pre-commit/mirrors-mypy</span>
<span id="cb10-34"><a href="#cb10-34" tabindex="-1"></a>    <span class="ex">rev:</span> v1.8.0</span>
<span id="cb10-35"><a href="#cb10-35" tabindex="-1"></a>    <span class="ex">hooks:</span></span>
<span id="cb10-36"><a href="#cb10-36" tabindex="-1"></a>      <span class="ex">-</span> id: mypy</span>
<span id="cb10-37"><a href="#cb10-37" tabindex="-1"></a></span>
<span id="cb10-38"><a href="#cb10-38" tabindex="-1"></a>  <span class="ex">-</span> repo: https://github.com/astral-sh/ruff-pre-commit</span>
<span id="cb10-39"><a href="#cb10-39" tabindex="-1"></a>    <span class="co"># Ruff version.</span></span>
<span id="cb10-40"><a href="#cb10-40" tabindex="-1"></a>    <span class="ex">rev:</span> v0.4.2</span>
<span id="cb10-41"><a href="#cb10-41" tabindex="-1"></a>    <span class="ex">hooks:</span></span>
<span id="cb10-42"><a href="#cb10-42" tabindex="-1"></a>      <span class="ex">-</span> id: ruff</span>
<span id="cb10-43"><a href="#cb10-43" tabindex="-1"></a>        <span class="ex">args:</span> [--fix, <span class="at">--exit-non-zero-on-fix,</span> <span class="at">--show-fixes]</span></span>
<span id="cb10-44"><a href="#cb10-44" tabindex="-1"></a></span>
<span id="cb10-45"><a href="#cb10-45" tabindex="-1"></a>  <span class="ex">-</span> repo: https://github.com/psf/black-pre-commit-mirror</span>
<span id="cb10-46"><a href="#cb10-46" tabindex="-1"></a>    <span class="ex">rev:</span> 23.12.1</span>
<span id="cb10-47"><a href="#cb10-47" tabindex="-1"></a>    <span class="ex">hooks:</span></span>
<span id="cb10-48"><a href="#cb10-48" tabindex="-1"></a>      <span class="ex">-</span> id: black</span>
<span id="cb10-49"><a href="#cb10-49" tabindex="-1"></a>        <span class="ex">types:</span> <span class="pp">[</span><span class="ss">python</span><span class="pp">]</span></span>
<span id="cb10-50"><a href="#cb10-50" tabindex="-1"></a>        <span class="ex">additional_dependencies:</span> <span class="pp">[</span><span class="st">"click==8.0.4"</span><span class="pp">]</span></span>
<span id="cb10-51"><a href="#cb10-51" tabindex="-1"></a>        <span class="ex">args:</span> [<span class="st">"--extend-exclude"</span>, <span class="st">"topostats/plotting.py"</span>]</span>
<span id="cb10-52"><a href="#cb10-52" tabindex="-1"></a>      <span class="ex">-</span> id: black-jupyter</span>
<span id="cb10-53"><a href="#cb10-53" tabindex="-1"></a></span>
<span id="cb10-54"><a href="#cb10-54" tabindex="-1"></a>  <span class="ex">-</span> repo: https://github.com/adamchainz/blacken-docs</span>
<span id="cb10-55"><a href="#cb10-55" tabindex="-1"></a>    <span class="ex">rev:</span> 1.16.0</span>
<span id="cb10-56"><a href="#cb10-56" tabindex="-1"></a>    <span class="ex">hooks:</span></span>
<span id="cb10-57"><a href="#cb10-57" tabindex="-1"></a>      <span class="ex">-</span> id: blacken-docs</span>
<span id="cb10-58"><a href="#cb10-58" tabindex="-1"></a>        <span class="ex">additional_dependencies:</span></span>
<span id="cb10-59"><a href="#cb10-59" tabindex="-1"></a>          <span class="ex">-</span> black==22.12.0</span>
<span id="cb10-60"><a href="#cb10-60" tabindex="-1"></a></span>
<span id="cb10-61"><a href="#cb10-61" tabindex="-1"></a>  <span class="ex">-</span> repo: https://github.com/codespell-project/codespell</span>
<span id="cb10-62"><a href="#cb10-62" tabindex="-1"></a>    <span class="ex">rev:</span> v2.2.6</span>
<span id="cb10-63"><a href="#cb10-63" tabindex="-1"></a>    <span class="ex">hooks:</span></span>
<span id="cb10-64"><a href="#cb10-64" tabindex="-1"></a>      <span class="ex">-</span> id: codespell</span>
<span id="cb10-65"><a href="#cb10-65" tabindex="-1"></a></span>
<span id="cb10-66"><a href="#cb10-66" tabindex="-1"></a>  <span class="ex">-</span> repo: https://github.com/pre-commit/mirrors-prettier</span>
<span id="cb10-67"><a href="#cb10-67" tabindex="-1"></a>    <span class="ex">rev:</span> v4.0.0-alpha.8</span>
<span id="cb10-68"><a href="#cb10-68" tabindex="-1"></a>    <span class="ex">hooks:</span></span>
<span id="cb10-69"><a href="#cb10-69" tabindex="-1"></a>      <span class="ex">-</span> id: prettier</span>
<span id="cb10-70"><a href="#cb10-70" tabindex="-1"></a></span>
<span id="cb10-71"><a href="#cb10-71" tabindex="-1"></a>  <span class="ex">-</span> repo: https://github.com/numpy/numpydoc</span>
<span id="cb10-72"><a href="#cb10-72" tabindex="-1"></a>    <span class="ex">rev:</span> v1.6.0</span>
<span id="cb10-73"><a href="#cb10-73" tabindex="-1"></a>    <span class="ex">hooks:</span></span>
<span id="cb10-74"><a href="#cb10-74" tabindex="-1"></a>      <span class="ex">-</span> id: numpydoc-validation</span>
<span id="cb10-75"><a href="#cb10-75" tabindex="-1"></a>        <span class="ex">exclude:</span> <span class="kw">|</span></span>
<span id="cb10-76"><a href="#cb10-76" tabindex="-1"></a>          <span class="kw">(</span><span class="ex">?x</span><span class="kw">)(</span></span>
<span id="cb10-77"><a href="#cb10-77" tabindex="-1"></a>              <span class="ex">tests/</span><span class="kw">|</span></span>
<span id="cb10-78"><a href="#cb10-78" tabindex="-1"></a>              <span class="ex">docs/</span></span>
<span id="cb10-79"><a href="#cb10-79" tabindex="-1"></a>          <span class="kw">)</span></span>
<span id="cb10-80"><a href="#cb10-80" tabindex="-1"></a></span>
<span id="cb10-81"><a href="#cb10-81" tabindex="-1"></a>  <span class="ex">-</span> repo: local</span>
<span id="cb10-82"><a href="#cb10-82" tabindex="-1"></a>    <span class="ex">hooks:</span></span>
<span id="cb10-83"><a href="#cb10-83" tabindex="-1"></a>      <span class="ex">-</span> id: pylint</span>
<span id="cb10-84"><a href="#cb10-84" tabindex="-1"></a>        <span class="ex">args:</span> <span class="pp">[</span><span class="st">"--rcfile=.pylintrc"</span><span class="pp">]</span></span>
<span id="cb10-85"><a href="#cb10-85" tabindex="-1"></a>        <span class="ex">name:</span> Pylint</span>
<span id="cb10-86"><a href="#cb10-86" tabindex="-1"></a>        <span class="ex">entry:</span> python <span class="at">-m</span> pylint</span>
<span id="cb10-87"><a href="#cb10-87" tabindex="-1"></a>        <span class="ex">language:</span> system</span>
<span id="cb10-88"><a href="#cb10-88" tabindex="-1"></a>        <span class="ex">files:</span> <span class="dt">\.</span>py$</span></code></pre>
</div>
<p>This <a href="https://yaml.org" class="external-link">YAML</a> file might look quite
complex and intimidating if you are not familiar with the format so
we’ll go through it in sections.</p>
<div class="section level3">
<h3 id="repos"><code>repos:</code><a class="anchor" aria-label="anchor" href="#repos"></a></h3>
<p>The top-level section <code>repos:</code> defines a list of the
repositories that are included and each of these is a specific
<code>pre-commit</code> hook that will be used and run when commits are
made. In YAML list entries start with a dash (<code>-</code>).</p>
</div>
<div class="section level3">
<h3 id="repo-httpsgithub-comuser_or_orgrepository"><code>- repo: https://github.com/&lt;USER_OR_ORG&gt;/&lt;REPOSITORY&gt;</code><a class="anchor" aria-label="anchor" href="#repo-httpsgithub-comuser_or_orgrepository"></a></h3>
<p>Each <code>repo</code> is then defined, the first line states where
the repository is hosted and these are typically, although not always on
<a href="https://github.com" class="external-link">GitHub</a>. The first one is for
<code>pre-commit-hooks</code> that come from the developers of
<code>pre-commit</code> itself. Other configured repositories are</p>
<ul><li><code>markdownlint-cli2</code></li>
<li><code>pyupgrade</code></li>
<li><code>mypy</code></li>
<li><code>ruff</code></li>
<li><code>black</code></li>
<li><code>black-jupyter</code></li>
<li><code>blacken-docs</code></li>
<li><code>codespell</code></li>
<li><code>prettier</code></li>
<li>
<code>local</code> - which runs <code>pylint</code> locally.</li>
</ul></div>
<div class="section level3">
<h3 id="rev"><code>rev:</code><a class="anchor" aria-label="anchor" href="#rev"></a></h3>
<p>The next line indicates the revision of the repo that you wish to
use. These are typically <code>git tags</code> that have been applied to
releases of the hook. In this example the revision is <code>4.5.0</code>
for the <code>pre-commit-hooks</code>.</p>
</div>
<div class="section level3">
<h3 id="hooks"><code>hooks:</code><a class="anchor" aria-label="anchor" href="#hooks"></a></h3>
<p>There then follows another entry called <code>hooks:</code> which
defines a list of <code>- id:</code> and each of these is the name of a
particular hook that will be run. There are hooks enabled for the
following and they are fairly explanatory but the <a href="https://pre-commit.com/hooks" class="external-link">hooks</a> page often has a one-line
explanation of what the hooks enable.</p>
<ul><li><code>check-case-conflict</code></li>
<li><code>check-docstring-first</code></li>
<li><code>check-merge-conflict</code></li>
<li><code>check-toml</code></li>
<li><code>check-yaml</code></li>
<li><code>debug-statements</code></li>
<li><code>end-of-file-fixer</code></li>
<li><code>fix-byte-order-marker</code></li>
<li><code>name-tests-test</code></li>
<li><code>no-commit-to-branch</code></li>
<li><code>requirements-txt-fixer</code></li>
<li><code>trailing-whitespace</code></li>
</ul><p>Some of the hooks have additional arguments (<code>args:</code>)
which are arguments that are passed to that particular hook or types
(<code>types</code>) which restrict the type of files the hook should
run on.</p>
<div id="callout4" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout</h3>
<div class="callout-content">
<p>You can add comments to YAML file by pre-fixing them with a
<code>#</code>. These may be at the start of a line or can be added to
the end of a line and the text that follows will be treated as a comment
and ignored when parsing the file.</p>
</div>
</div>
</div>
<div id="accordionInstructor2" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor2" aria-expanded="false" aria-controls="collapseInstructor2">
  <h3 class="accordion-header" id="headingInstructor2">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Instructor Note </h3>
</button>
<div id="collapseInstructor2" class="accordion-collapse collapse" data-bs-parent="#accordionInstructor2" aria-labelledby="headingInstructor2">
<div class="accordion-body">
<p>Check that attendees are familiar with <code>grep</code> and
searching files for strings. If people are unfamiliar explain clearly
what each solution is doing in terms of the string being searched for,
the target file (<code>.pre-commit-config.yaml</code>) the before
(<code>-B</code>) and after (<code>-A</code>) flags and how the pipe
(<code>|</code>) command is used to chain expressions together.</p>
</div>
</div>
</div>
</div>
<div id="understanding-.pre-commit-config.yaml" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="understanding-.pre-commit-config.yaml" class="callout-inner">
<h3 class="callout-title">Understanding
<code>.pre-commit-config.yaml</code>
</h3>
<div class="callout-content">
<p>Now that we’ve gone through the structure of how a
<code>pre-commit</code> repository is defined and configured lets look
at some of the others that are defined.</p>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5"> Challenge 3: What version of the numpydoc repo is configured </h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" data-bs-parent="#accordionSolution5" aria-labelledby="headingSolution5">
<div class="accordion-body">
<p>Using <a href="https://en.wikipedia.org/wiki/Grep" class="external-link">grep</a> to search
for the <code>numpydoc</code> string in the
<code>.pre-commit-config.yaml</code> we can hone in on the
<code>repo</code> and its associated <code>rev</code>.</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="ex">❱</span> grep <span class="at">-A1</span> numpydoc .pre-commit-config.yaml  <span class="kw">|</span> <span class="fu">grep</span> <span class="at">-B1</span> rev</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>  <span class="ex">-</span> repo: https://github.com/numpy/numpydoc</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>    <span class="ex">rev:</span> v1.6.0</span></code></pre>
</div>
<p>We see that it is <code>v1.6.0</code> that is currently configured
for <code>numpydoc</code>.</p>
</div>
</div>
</div>
</div>
<div id="accordionSolution6" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution6" aria-expanded="false" aria-controls="collapseSolution6">
  <h4 class="accordion-header" id="headingSolution6"> Challenge 4: What hook(s) is/are enabled from the black-pre-commit-mirror repo? </h4>
</button>
<div id="collapseSolution6" class="accordion-collapse collapse" data-bs-parent="#accordionSolution6" aria-labelledby="headingSolution6">
<div class="accordion-body">
<p>Searching for the <code>black-pre-commit-mirror</code> in the
configuration and then looking for the <code>id</code> shows us what
hooks are configured for this <code>repi</code>.</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="ex">❱</span> grep <span class="at">-A10</span> <span class="st">"black-pre-commit-mirror"</span> .pre-commit-config.yaml <span class="kw">|</span> <span class="fu">grep</span> <span class="st">"id:"</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>      <span class="ex">-</span> id: black</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>      <span class="ex">-</span> id: black-jupyter</span></code></pre>
</div>
<p>The <code>black</code> and <code>black-jupyter</code> hooks are
enabled. These will apply <a href="https://black.readthedocs.io/en/stable/index.html" class="external-link">black</a>
formatting to Python files and Jupyter Notebooks.</p>
</div>
</div>
</div>
</div>
<div id="accordionSolution7" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution7" aria-expanded="false" aria-controls="collapseSolution7">
  <h4 class="accordion-header" id="headingSolution7"> Challenge 5: What arguments are listed for the ruff hook? </h4>
</button>
<div id="collapseSolution7" class="accordion-collapse collapse" data-bs-parent="#accordionSolution7" aria-labelledby="headingSolution7">
<div class="accordion-body">
<p>Finally searching for <code>ruff</code> in
<code>.pre-commit-config.yaml</code> and then looking for the
<code>args</code> field we can find out what arguments are passed to the
<a href="https://astral.sh/ruff" class="external-link">ruff</a> linter.</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="ex">❱</span> grep <span class="at">-A5</span> ruff .pre-commit-config.yaml <span class="kw">|</span> <span class="fu">grep</span> <span class="st">"args:"</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>        <span class="ex">args:</span> [--fix, <span class="at">--exit-non-zero-on-fix,</span> <span class="at">--show-fixes]</span></span></code></pre>
</div>
<p>The <code>--fix</code>, <code>--exit-non-zero-on-fix</code> and
<code>--show-fixes</code> options are enabled.</p>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="installing-pre-commit-hooks">Installing <code>pre-commit</code> hooks<a class="anchor" aria-label="anchor" href="#installing-pre-commit-hooks"></a></h2>
<hr class="half-width"><p>The <code>.git/hooks/pre-commit</code> is a Bash script that runs
<code>pre-commit</code> but where do the hooks come from? There is a
hint in the configuration file where each <code>- repo:</code> is
defined which points to a Git repository which contains the code and
environment to run the hook.</p>
<p>These need downloading and initialising before they will run on your
local system and that is achieved using
<code>pre-commit install-hooks</code>.</p>
<p>The repos that are defined need installing, this is done once and
sets up some virtual environments which are reused across Git
repositories that have <code>pre-commit</code> installed. If the
<code>ref:</code> is changed or updated then it will require downloading
a new environment.</p>
</section><section><h2 class="section-heading" id="running-pre-commit">Running <code>pre-commit</code>
<a class="anchor" aria-label="anchor" href="#running-pre-commit"></a></h2>
<hr class="half-width"><p>Whilst configured as a hook to run before commits
<code>pre-commit</code> can be run at any time against the whole
repository</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="ex">❱</span> pre-commit run <span class="at">--all-files</span></span></code></pre>
</div>
<p>…or on individual files, in this case <code>pyproject.toml</code> and
<code>README.md</code></p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="ex">❱</span> pre-commit run <span class="at">--files</span> pyproject.toml README.md</span></code></pre>
</div>
<p>If there are problems identified with any of the files
<code>pre-commit</code> will report them and you will have to fix them
and include the changes, staging before committing them (remember not to
commit to the wrong branch such as <code>main</code>).</p>
</section><section><h2 class="section-heading" id="adding-hooks">Adding Hooks<a class="anchor" aria-label="anchor" href="#adding-hooks"></a></h2>
<hr class="half-width"><p>Which hooks you use will depend largely on the language you are using
but there are hundreds of hooks available and these can be browsed at
the <a href="https://pre-commit.com/hooks" class="external-link">website</a>. The
<code>python-maths</code> repository has a number of <a href="https://github.com/pre-commit/pre-commit-hooks" class="external-link">pre-commit-hooks</a>
enabled but lets add some more.</p>
<p>Looking at the <a href="https://github.com/pre-commit/pre-commit-hooks" class="external-link">pre-commit-hooks
repo</a> we can see there are a few hooks that we could enable. We will
create a new branch to make these changes on and add the
<code>detect-private-keys</code>, and prevent files larger than 800kb
from being added using the <code>check-added-large-files</code>
hook.</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="ex">❱</span> cd python-maths</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a><span class="ex">❱</span> git switch main</span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a><span class="ex">❱</span> git pull</span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a><span class="ex">❱</span> git switch <span class="at">-c</span> ns-rse/add-pre-commit-hooks</span></code></pre>
</div>
<p>Add the following <code>- id:</code> to the <code>hooks:</code>
section defined under the first <code>- repo:</code>.</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">YAML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode yaml" tabindex="0"><code class="sourceCode yaml"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">id</span><span class="kw">:</span><span class="at"> check-added-large-files</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a><span class="at">        </span><span class="fu">args</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">"--maxkb=800"</span><span class="kw">]</span></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">id</span><span class="kw">:</span><span class="at"> detect-private-keys</span></span></code></pre>
</div>
<p>It can help with readability if you order the hooks alphabetically so
you may have something that reads like the following.</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">YAML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode yaml" tabindex="0"><code class="sourceCode yaml"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="fu">repos</span><span class="kw">:</span></span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">repo</span><span class="kw">:</span><span class="at"> https://github.com/pre-commit/pre-commit-hooks</span></span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a><span class="at">    </span><span class="fu">rev</span><span class="kw">:</span><span class="at"> v4.5.0</span><span class="co"> # Use the ref you want to point at</span></span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a><span class="at">    </span><span class="fu">hooks</span><span class="kw">:</span></span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">id</span><span class="kw">:</span><span class="at"> check-added-large-files</span></span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a><span class="at">        </span><span class="fu">args</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">"--maxkb=800"</span><span class="kw">]</span></span>
<span id="cb18-7"><a href="#cb18-7" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">id</span><span class="kw">:</span><span class="at"> check-case-conflict</span></span>
<span id="cb18-8"><a href="#cb18-8" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">id</span><span class="kw">:</span><span class="at"> check-docstring-first</span></span>
<span id="cb18-9"><a href="#cb18-9" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">id</span><span class="kw">:</span><span class="at"> check-merge-conflict</span></span>
<span id="cb18-10"><a href="#cb18-10" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">id</span><span class="kw">:</span><span class="at"> check-toml</span></span>
<span id="cb18-11"><a href="#cb18-11" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">id</span><span class="kw">:</span><span class="at"> check-yaml</span></span>
<span id="cb18-12"><a href="#cb18-12" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">id</span><span class="kw">:</span><span class="at"> debug-statements</span></span>
<span id="cb18-13"><a href="#cb18-13" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">id</span><span class="kw">:</span><span class="at"> detect-private-keys</span></span>
<span id="cb18-14"><a href="#cb18-14" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">id</span><span class="kw">:</span><span class="at"> end-of-file-fixer</span></span>
<span id="cb18-15"><a href="#cb18-15" tabindex="-1"></a><span class="at">        </span><span class="fu">types</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at">python</span><span class="kw">]</span></span>
<span id="cb18-16"><a href="#cb18-16" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">id</span><span class="kw">:</span><span class="at"> fix-byte-order-marker</span></span>
<span id="cb18-17"><a href="#cb18-17" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">id</span><span class="kw">:</span><span class="at"> name-tests-test</span></span>
<span id="cb18-18"><a href="#cb18-18" tabindex="-1"></a><span class="at">        </span><span class="fu">args</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">"--pytest-test-first"</span><span class="kw">]</span></span>
<span id="cb18-19"><a href="#cb18-19" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">id</span><span class="kw">:</span><span class="at"> no-commit-to-branch</span><span class="co"> # Protects main/master by default</span></span>
<span id="cb18-20"><a href="#cb18-20" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">id</span><span class="kw">:</span><span class="at"> requirements-txt-fixer</span></span>
<span id="cb18-21"><a href="#cb18-21" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">id</span><span class="kw">:</span><span class="at"> trailing-whitespace</span></span>
<span id="cb18-22"><a href="#cb18-22" tabindex="-1"></a><span class="at">        </span><span class="fu">types</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at">python</span><span class="kw">,</span><span class="at"> yaml</span><span class="kw">,</span><span class="at"> markdown</span><span class="kw">]</span></span></code></pre>
</div>
<p>After you have made changes to <code>.pre-commit-config.yaml</code>
you <em>have</em> to stage them for committing, if you don’t the
<code>pre-commit</code> programme will complain about it being
unstaged.</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="ex">❱</span> cd python-maths</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a><span class="ex">❱</span> git commit <span class="at">--allow-empty</span> <span class="at">-m</span> <span class="st">"Trying to commit without staging .pre-commit-config.yaml"</span></span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a><span class="ex">[ERROR]</span> Your pre-commit configuration is unstaged.</span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a><span class="kw">`</span><span class="fu">git</span> add .pre-commit-config.yaml<span class="kw">`</span> to fix this.</span></code></pre>
</div>
<p>Whenever you modify, add or delete content to
<code>.pre-commit-configy.yaml</code> you must therefore stage and
commit the changes (<strong>NB</strong> make sure youre are)</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="ex">❱</span> git add .pre-commit-config.yaml</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a><span class="ex">❱</span> git commit <span class="at">-m</span> <span class="st">"pre-commit : Exclude large files and detect private keys"</span></span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a><span class="ex">❱</span> git push <span class="at">--set-upstream</span> origin ns-rse/add-pre-commit-hooks</span></code></pre>
</div>
<div id="challenge-6-add-the-forbid-new-submodules-hook-id-to-the-pre-commit-hooks-configuration" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-6-add-the-forbid-new-submodules-hook-id-to-the-pre-commit-hooks-configuration" class="callout-inner">
<h3 class="callout-title">Challenge 6: Add the
<code>forbid-new-submodules</code> hook id to the
<code>pre-commit-hooks</code> configuration</h3>
<div class="callout-content">

</div>
</div>
</div>
<div id="accordionSolution8" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution8" aria-expanded="false" aria-controls="collapseSolution8">
  <h4 class="accordion-header" id="headingSolution8"> Show me the solution </h4>
</button>
<div id="collapseSolution8" class="accordion-collapse collapse" data-bs-parent="#accordionSolution8" aria-labelledby="headingSolution8">
<div class="accordion-body">
<p>The following line should be added under the <code>hooks:</code>
section of the
<code>- repo: https://github.com/pre-commit/pre-commit-hooks</code>
repository configuration.</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">YAML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode yaml" tabindex="0"><code class="sourceCode yaml"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">id</span><span class="kw">:</span><span class="at"> forbid-new-submodules</span></span></code></pre>
</div>
<p>The file should then be staged, committed and pushed.</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="ex">❱</span> git add .pre-commit-config.yaml</span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a><span class="ex">❱</span> git commit <span class="at">-m</span> <span class="st">"pre-commit : adds the forbid-new-modules hook"</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="adding-repos">Adding repos<a class="anchor" aria-label="anchor" href="#adding-repos"></a></h2>
<hr class="half-width"><p>The definitive <a href="https://pre-commit.com/hooks" class="external-link">list</a> of
<code>pre-commit</code> repos is maintained on the official website.
Each entry links to the GitHub repository and most contain in their
<code>README.md</code> instructions on how to use the hooks.</p>
<div id="challenge-7-add-the-numpydoc-repo-exclude-the-tests-and-doc-directories-and-run-it-against-the-code-base" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-7-add-the-numpydoc-repo-exclude-the-tests-and-doc-directories-and-run-it-against-the-code-base" class="callout-inner">
<h3 class="callout-title">Challenge 7: Add the <code>numpydoc</code>
repo, exclude the <code>tests/</code> and <code>doc/</code> directories
and run it against the code base</h3>
<div class="callout-content">
<p>The <a href="https://github.com/numpy/numpydoc" class="external-link">numpydoc</a> repo
defines hooks that check the Python docstrings conform to the <a href="https://numpydoc.readthedocs.io/en/latest/format.html" class="external-link">Numpydoc
style guide</a>. Following the instructions add the repo to the
<code>.pre-commit-config.yaml</code> (on a new branch)</p>
</div>
</div>
</div>
<div id="accordionSolution9" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution9" aria-expanded="false" aria-controls="collapseSolution9">
  <h4 class="accordion-header" id="headingSolution9"> Show me the solution </h4>
</button>
<div id="collapseSolution9" class="accordion-collapse collapse" data-bs-parent="#accordionSolution9" aria-labelledby="headingSolution9">
<div class="accordion-body">
<p>Create a branch to undertake the work on.</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="ex">❱</span> git switch main</span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a><span class="ex">❱</span> git pull</span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a><span class="ex">❱</span> git switch <span class="at">-c</span> ns-rse/pre-commit-numpydoc</span></code></pre>
</div>
<p>The following should be added to your
<code>.pre-commit-config.yaml</code></p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">YAML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode yaml" tabindex="0"><code class="sourceCode yaml"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="at">   </span><span class="kw">-</span><span class="at"> </span><span class="fu">repo</span><span class="kw">:</span><span class="at"> https://github.com/numpy/numpydoc</span></span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a><span class="at">     </span><span class="fu">rev</span><span class="kw">:</span><span class="at"> v1.6.0</span></span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a><span class="at">     </span><span class="fu">hooks</span><span class="kw">:</span></span>
<span id="cb24-4"><a href="#cb24-4" tabindex="-1"></a><span class="at">       </span><span class="kw">-</span><span class="at"> </span><span class="fu">id</span><span class="kw">:</span><span class="at"> numpydoc-validation</span></span>
<span id="cb24-5"><a href="#cb24-5" tabindex="-1"></a><span class="fu">         exclude</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb24-6"><a href="#cb24-6" tabindex="-1"></a>           (?x)(</span>
<span id="cb24-7"><a href="#cb24-7" tabindex="-1"></a>               tests/|</span>
<span id="cb24-8"><a href="#cb24-8" tabindex="-1"></a>               docs/</span>
<span id="cb24-9"><a href="#cb24-9" tabindex="-1"></a>           )</span></code></pre>
</div>
<p>Check that the code base passes the checks, correct any errors that
are highlighted.</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="ex">❱</span> pre-commit run numpydoc <span class="at">--all-files</span></span></code></pre>
</div>
<p>The file should then be staged, committed and pushed.</p>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="ex">❱</span> git add .pre-commit-config.yaml</span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a><span class="ex">❱</span> git commit <span class="at">-m</span> <span class="st">"pre-commit : adds the numpydoc repo/hook"</span></span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a><span class="ex">❱</span> git push</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="local-repos">Local repos<a class="anchor" aria-label="anchor" href="#local-repos"></a></h2>
<hr class="half-width"><p>Local repo are those that do not use hooks defined by others and are
instead defined by the user. This comes in handy when you want to run
checks which have dependencies that are specific to the code such as
running <a href="https://pylint.org" class="external-link">pylint</a> which needs to import
all the dependencies that are used or run a test suite.</p>
<p>The <code>python-maths</code> module already has a section defined
that runs <code>pylint</code> locally. When running on a repository it
will therefore be essential that you have a virtual/conda environment
activated that has all the dependencies installed.</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">YAML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode yaml" tabindex="0"><code class="sourceCode yaml"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="at">   </span><span class="kw">-</span><span class="at"> </span><span class="fu">repo</span><span class="kw">:</span><span class="at"> local</span></span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a><span class="at">     </span><span class="fu">hooks</span><span class="kw">:</span></span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a><span class="at">       </span><span class="kw">-</span><span class="at"> </span><span class="fu">id</span><span class="kw">:</span><span class="at"> pylint</span></span>
<span id="cb27-4"><a href="#cb27-4" tabindex="-1"></a><span class="at">         </span><span class="fu">args</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">"--rcfile=.pylintrc"</span><span class="kw">]</span></span>
<span id="cb27-5"><a href="#cb27-5" tabindex="-1"></a><span class="at">         </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Pylint</span></span>
<span id="cb27-6"><a href="#cb27-6" tabindex="-1"></a><span class="at">         </span><span class="fu">entry</span><span class="kw">:</span><span class="at"> python -m pylint</span></span>
<span id="cb27-7"><a href="#cb27-7" tabindex="-1"></a><span class="at">         </span><span class="fu">language</span><span class="kw">:</span><span class="at"> system</span></span>
<span id="cb27-8"><a href="#cb27-8" tabindex="-1"></a><span class="at">         </span><span class="fu">files</span><span class="kw">:</span><span class="at"> \.py$</span></span></code></pre>
</div>
<p>Several of the configuration options we have already seen such as
<code>id</code>, <code>args</code> and <code>files</code> but the
<code>name:</code> field gives the hook a name and the
<code>entry:</code> defines what is actually run, in this case
<code>python -m pylint</code> which will take the define argument
<code>--rcfile=.pylintrc</code>, and so what actually gets executed
is</p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a><span class="ex">python</span> <span class="at">-m</span> pylint <span class="at">--rcfile</span><span class="op">=</span>.pylintrc</span></code></pre>
</div>
<div id="callout5" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout</h3>
<div class="callout-content">
<p>The <code>.pylintrc</code> file is a configuration file for
<code>pylint</code> that defines what checks are made.</p>
</div>
</div>
</div>
<div id="challenge-9-define-local-pre-commit-repo-to-run-a-pytest-hook" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-9-define-local-pre-commit-repo-to-run-a-pytest-hook" class="callout-inner">
<h3 class="callout-title">Challenge 9: Define local
<code>pre-commit</code> repo to run a <code>pytest</code> hook</h3>
<div class="callout-content">
<p>The <code>python-maths</code> repository has a suite of tests that
can be run to ensure the code works as expected.</p>
<p>Pytest is run simply with <code>pytest</code>.</p>
</div>
</div>
</div>
<div id="accordionSolution10" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution10" aria-expanded="false" aria-controls="collapseSolution10">
  <h4 class="accordion-header" id="headingSolution10"> Show me the solution </h4>
</button>
<div id="collapseSolution10" class="accordion-collapse collapse" data-bs-parent="#accordionSolution10" aria-labelledby="headingSolution10">
<div class="accordion-body">
<p>Create a branch to undertake the work on.</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a><span class="ex">❱</span> git switch main</span>
<span id="cb29-2"><a href="#cb29-2" tabindex="-1"></a><span class="ex">❱</span> git pull</span>
<span id="cb29-3"><a href="#cb29-3" tabindex="-1"></a><span class="ex">❱</span> git switch <span class="at">-c</span> ns-rse/pre-commit-pytest</span></code></pre>
</div>
<p>The following should be added to your
<code>.pre-commit-config.yaml</code></p>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">YAML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode yaml" tabindex="0"><code class="sourceCode yaml"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a><span class="at">   </span><span class="kw">-</span><span class="at"> </span><span class="fu">repo</span><span class="kw">:</span><span class="at"> local</span></span>
<span id="cb30-2"><a href="#cb30-2" tabindex="-1"></a><span class="at">     </span><span class="fu">hooks</span><span class="kw">:</span></span>
<span id="cb30-3"><a href="#cb30-3" tabindex="-1"></a><span class="at">       </span><span class="kw">-</span><span class="at"> </span><span class="fu">id</span><span class="kw">:</span><span class="at"> pytest</span></span>
<span id="cb30-4"><a href="#cb30-4" tabindex="-1"></a><span class="at">         </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Pytest</span></span>
<span id="cb30-5"><a href="#cb30-5" tabindex="-1"></a><span class="at">         </span><span class="fu">entry</span><span class="kw">:</span><span class="at"> pytest</span></span>
<span id="cb30-6"><a href="#cb30-6" tabindex="-1"></a><span class="at">         </span><span class="fu">language</span><span class="kw">:</span><span class="at"> system</span></span></code></pre>
</div>
<p>Check that the code base passes the checks, correct any errors that
are highlighted.</p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a><span class="ex">❱</span> pre-commit run pytest <span class="at">--all-files</span></span></code></pre>
</div>
<p>The file should then be staged, committed and pushed.</p>
<div class="codewrapper sourceCode" id="cb32">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a><span class="ex">❱</span> git add .pre-commit-config.yaml</span>
<span id="cb32-2"><a href="#cb32-2" tabindex="-1"></a><span class="ex">❱</span> git commit <span class="at">-m</span> <span class="st">"pre-commit : adds a local pytest repo/hook"</span></span>
<span id="cb32-3"><a href="#cb32-3" tabindex="-1"></a><span class="ex">❱</span> git push</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="keeping-pre-commit-tidy">Keeping <code>pre-commit</code> tidy<a class="anchor" aria-label="anchor" href="#keeping-pre-commit-tidy"></a></h2>
<hr class="half-width"><p><code>pre-commit</code> downloads and installs lots of code on your
behalf, including virtual environments that are activated to run the
tests. It stores these in the <code>~/.cache/pre-commit/</code>
directory and you will find a few common files (<code>.lock</code>,
<code>db.db</code> and <code>README</code>) along with a bunch of
directories with hashed names. These directories are the code and
environments used to run the different hooks.</p>
<p>Over time and across multiple projects the size of this cache
directory can grow so its good practice to periodically tidy up and
there are two commands for doing so, which you should run
periodically.</p>
<div class="section level3">
<h3 id="cleaning-and-garbage-collection">Cleaning and Garbage Collection<a class="anchor" aria-label="anchor" href="#cleaning-and-garbage-collection"></a></h3>
<p>The <code>pre-commit clean</code> command will clean out files that
have been left around periodically, these tend not to be too large so
are less of a problem.</p>
<p>Cached virtual environments can grow to be quite large though, but
they can be easily tidied up using the <code>pre-commit gc</code>
command (<code>gc</code> stands for Garbage Collection.</p>
</div>
</section><section><h2 class="section-heading" id="going-further">Going further<a class="anchor" aria-label="anchor" href="#going-further"></a></h2>
<hr class="half-width"><p>Despite the name <code>pre-commit</code> actually supports hooks at
many different stages <a href="https://pre-commit.com/index.html#confining-hooks-to-run-at-certain-stages" class="external-link">stages</a>.
Whether these run will depend on where they are defined to run in the
<code>.pre-commit-hooks.yaml</code> of the repo you are using, but they
can also be over-ridden locally by setting the <code>stages</code>.</p>
<p>There are also <a href="https://pre-commit.com/index.html#pre-commit-configyaml---top-level" class="external-link">top-level</a>
configuration options where you can set a global file include
(<code>files: "&lt;pattern&gt;"</code>) and exclude
(<code>exclude: "&lt;pattern&gt;"</code>) pattern which would apply
across all configured repositories.</p>
</section><section><h2 class="section-heading" id="ci"><code>ci:</code><a class="anchor" aria-label="anchor" href="#ci"></a></h2>
<hr class="half-width"><p>There is one section of the configuration which we haven’t covered
yet, the <code>ci:</code> section defined at the bottom. This controls
how <code>pre-commit</code> runs and is used in Continuous Integration
which is the topic of our next chapter.</p>
<p>We’ve seen how hooks and in particular the <a href="https://pre-commit.com" class="external-link">pre-commit</a> suite can be used to
automate many tasks such as running linting checks on your code base
prior to commits. A short coming of this approach is that whilst the
configuration file (<code>.pre-commit-config.yaml</code>) may live in
your repository it means that every person contributing to the code has
to install the hooks and ensure they run locally.</p>
<p>Not everyone who contributes to your code will do this that is where
<a href="https://pre-commit.ci" class="external-link">pre-commit.ci</a> comes in handy as it
runs the Pre-commit hooks as part of the Continuous Integration on
GitHub which is the focus of the next episode.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul><li>Hooks are actions run by Git before or after particular events such
as <code>commit</code>, <code>push</code> and <code>pull</code> via
scripts.</li>
<li>They are defined in Bash scripts in the <code>.git/hooks</code>
directory.</li>
<li>The <code>pre-commit</code> framework provides a wealth of hooks
that can be enabled to run, by default, before commits are made.</li>
<li>Each hook can be configured to run on specific files, or to take
additional arguments.</li>
<li>Local hooks can be configured to run when dependencies that will
only be found on your system/virtual environment are required.</li>
<li>Use hooks liberally as you develop your code locally, they save you
time.</li>
</ul></div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="../instructor/diverging_branches.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="../instructor/continuous_integration.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="../instructor/diverging_branches.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Diverging Branches
        </a>
        <a class="chapter-link float-end" href="../instructor/continuous_integration.html" rel="next">
          Next: Continuous...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-2">
        <a href="https://docs.hpc.shef.ac.uk/en/latest/stanage/index.html" class="external-link">
          <img alt="Stanage HPC" src="https://docs.hpc.shef.ac.uk/en/latest/_images/Stanage_Black.png" style="width: 100%;" class="dark-invert"></a>
        <p><a href="https://sites.google.com/sheffield.ac.uk/research-training/research-training" class="external-link">Research Computing Training Home</a></p>
			</div>
			<div class="col-md-5">
        <p>Lesson developed by <a href="https://rse.shef.ac.uk" class="external-link">RSE</a> &amp; <a href="https://www.sheffield.ac.uk/it-services/research" class="external-link">RIT</a></p>
        <p>

          <a href="https://github.com/ns-rse/git-collaboration/edit/main/episodes/hooks.md" class="external-link">Edit on GitHub</a>


        | <a href="https://github.com/ns-rse/git-collaboration/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/ns-rse/git-collaboration/" class="external-link">Source</a>
        </p>
		<p>
          <a href="https://github.com/ns-rse/git-collaboration/blob/main/CITATION.cff" class="external-link">Cite</a> | <a href="mailto:n.shephard@sheffield.ac.uk">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a> | <a href="CODE_OF_CONDUCT.html">Code of Conduct</a>
        </p>
		</div>
		<div class="col-md-5">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>


        <!--<p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/">CC-BY 4.0</a> by <a href="https://carpentries.org/">The Carpentries</a></p>-->
        <!--<p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.7">sandpaper (0.16.7)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.6">pegboard (0.7.6)</a>, and <a href="https://github.com/RSE-Sheffield/uos-varnish/tree/main">varnish (1.0.4)</a></p>-->
        <p><a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">Template licensed under CC-BY 4.0</a> by <a href="https://carpentries.org" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.7" class="external-link">sandpaper (0.16.7)</a>,
        <a href="https://github.com/carpentries/pegboard/tree/0.7.6" class="external-link">pegboard (0.7.6)</a>,
      and <a href="https://github.com/RSE-Sheffield/uos-varnish/tree/main" class="external-link">varnish (1.0.4) [UoS fork]</a>.</p>
			</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "ns-rse.github.io/git-collaboration/instructor/hooks.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, lesson, The Carpentries, git, collaboration",
  "name": "Hooks",
  "creativeWorkStatus": "active",
  "url": "ns-rse.github.io/git-collaboration/instructor/hooks.html",
  "identifier": "ns-rse.github.io/git-collaboration/instructor/hooks.html",
  "dateCreated": "2023-10-09",
  "dateModified": "2024-08-02",
  "datePublished": "2024-10-04"
}

  </script><script>
		feather.replace();
	</script></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

